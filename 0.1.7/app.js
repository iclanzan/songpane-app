app=angular.module("SongPane",[]),function(e){var t="//api.songpane.com/",n="kid_Ve5MJ5EOhM",o="03910d2676f34fd5bcae148188556e06";e.config(["$routeProvider","$httpProvider",function(e,t){e.when("/").when("/set/:setId/:songId").when("/:view/:songId").otherwise("/"),delete t.defaults.headers.common["X-Requested-With"],t.defaults.headers.common["X-Kinvey-Api-Version"]="2",t.defaults.cache=!1,t.responseInterceptors.push(["$q","$injector","notifier","locale","util",function(e,t,n,o,r){function i(o){var r=o.status;return 0===r&&(o.data=s.noConnection),401==r?(a=a||t.get("auth"),a.isLoggedIn()&&(a.logout(),n.notify({message:o.data=s.loggedOut,icon:"alert"}))):404==r?n.notify({message:o.data=s.notFound,icon:"alert"}):n.notify({message:o.data=s.genericError,icon:"alert"}),e.reject(o)}var a,s=o._;return function(e){return e.then(r.identity,i)}}])}]).run(["$rootScope","auth","collection","util","transitioner","keyboard","modal","notifier","$window","locale",function(e,r,i,a,s,c,u,l,d,f){var p,g,h=d.navigator,m=f._;d.notify=l.notify,r.setup({url:t+"user/"+n+"/",key:n,secret:o}),"standalone"in h&&!h.standalone&&l.notify({message:m.standalone,icon:"songpane"}),e.change=!1,e.$on("ready",function(){e.ready=!0}),e.$on("login",function(){e.loginClass="",e.requireLogin&&s.apply("login",function(){e.requireLogin=!1}),p=e.sets=i({songs:[],isNeeded:function(e){var t=this.songs,n=e.songs;return n.forEach(function(e){var o=e._id;n[o]=e,a.list(t,o)}),!0},url:t+"appdata/"+n+"/set/",params:{query:{_id:{$in:r.me().sets}}},interval:6e4,onNew:function(e){var t=r.me(),n=t.sets,o=e._id;return n.push(o),r.save(t),e},hasSong:function(e){return-1!==this.songs.indexOf(e)?!0:!1}}),g=e.songs=i({url:t+"appdata/"+n+"/song/",params:{ids:p.songs},isNeeded:function(e){return this.isOwner(e)||p.hasSong(e._id)?!0:!1},getKey:function(e,t){var n=g[e];return t&&p[t]&&p[t].songs&&p[t].songs[e]&&p[t].songs[e].key||n.userKey||n.key}}),p.run(function(){g.run(function(){e.$emit("ready")})})}),e.$on("logout",function(){e.ready=!1,u(),p.deleteStore(),g.deleteStore(),p.interval=0,p=g=e.sets=e.songs=null,e.requireLogin=!0}),r.isLoggedIn()?e.$emit("login"):e.requireLogin=!0,e.modal=u,e.toggleState=function(t){e[t]=!e[t],e.changedState=!0},e.resetState=function(){return e.changedState?(e.changedState=!1,undefined):(["menu","em"].forEach(function(t){e[t]&&(e[t]=!1)}),undefined)},c.on("ctrl+shift",function(){e.slow=!e.slow}).on(["h","?"],function(){return u("keyboard"),e.$apply(),!1})}])}(app),app.controller("addController",["$scope","$routeParams","$rootScope","util",function(e,t,n,o){var r=n.sets,i=n.songs;e.addNew=function(e){var n=t.songId;return i.keep(n),r.save({title:e,songs:[{_id:n}]})},e.addExisting=function(e){var n=t.songId;return o.list(r[e].songs,{_id:n})&&i.keep(n)&&r.save(r[e])}}]),app.controller("confirmController",["$scope","$routeParams","$rootScope","util","$location",function(e,t,n,o,r){var i=n.sets,a=n.songs;e.trashSong=function(){var e=t.songId,n=t.setId;return i.forEach(function(t){o.unlist(t.songs,e)||i.remove(t._id)}),r.path((n?"set":t.view)+"/"+(i[n]?n+"/":"")),a.remove(e)}}]),app.controller("loginController",["$scope","auth","locale","md5",function(e,t,n,o){var r=n._;e.login=function(n,o){e.message=r.wait,t.login(n,o,function(t,n){t||(e.message="InvalidCredentials"==n.error?r.invalidCredentials:r.genericError)})},e.reset=function(n){e.message=r.wait,t.reset(n,function(t){e.message=t?"":r.genericError})},e.md5=o,e._=r,e.message=""}]),app.controller("newController",["$scope","$rootScope","transposer","songMode","$routeParams","util","locale","notifier",function(e,t,n,o,r,i,a,s){var c=t.songs,u=r.edit,l=a._;e.songMode=o,e.langs=a.langs,u&&(e.song=i.extend({},c[r.songId]),"clone"==u&&delete e.song._id,e.song.tempo=e.song.tempo-0),e.saveSong=function(e,t){var o="("+n.getScale(e.key).join("|")+")";return~e.body.search("^(?:\\[[1-9bcpio]\\]\\n(?:(?: *"+o+"[1-9adgijmsu,\\(\\)]*(?:\\/"+o+")?)*\\n[^\\[\\n].+(?:\\n|$))+)+$")?(t&&(e._acl={gr:!1}),c.save(e)):(s.notify({message:l.checkBody,icon:"alert"}),void 0)},e.keys=n.getAllKeys()}]),app.controller("renameController",["$scope","$rootScope",function(e,t){var n=t.sets;e.renameSet=function(e,t){var o=n[e];return t!==o.title?(o.title=t,n.save(o)):!1}}]),app.controller("searchController",["$scope","$rootScope","locale",function(e,t,n){var o=t.songs;e._=n._,e.message="",e.search=function(t){e.s=e.n=!0,o.query({query:{body:{$regex:t,$options:"i"}},limit:100},function(t){e.results=t,e.s=!1})}}]),app.controller("settingsController",["$scope","auth","settings",function(e,t,n){e.s=n.settings,e.toggle=function(e){n.toggle(e)},e.setFont=function(e){n.set("fontSize",e)},e.logout=function(){return t.logout(),!0}}]),app.controller("shareController",["$scope","$routeParams","$rootScope","md5","util",function(e,t,n,o,r){var i=r.list,a=r.unlist,s=n.sets,c=t.setId,u=e.e=s.getWriters(c).slice(0),l=e.c=s.getReaders(c).slice(0);e.owner=s.getOwner(c),e.md5=o,e.allowAccess=function(e,t){return i(l,e),"edit"==t&&i(u,e),!0},e.denyAccess=function(e){a(u,e),a(l,e)},e.isOwner=function(){return s.isOwner(s[c])},e.save=function(){return s.setReaders(c,l).setWriters(c,u).save(s[c])}}]),app.controller("uiController",["$scope","$rootScope","$routeParams","$location","settings","util","keyboard","transposer","transitioner","locale","$timeout","store","auth","modal",function(e,t,n,o,r,i,a,s,c,u,l,d,f,p){function g(e,t,n){var o,r,i,a,c,u,l,d,f,p,g=[];return e.split("[").forEach(function(e){if(""!==e){for(o=e.split("]"),r={type:o[0].toLowerCase(),lines:[]},i=o[1].replace(/[\r\t\v\f\0\x0B]|^\n+|\s+$/g,"").split("\n"),a=0,c=i.length;c>a;a+=2){for(u=i[a].match(/\S+/g)||[],f=i[a].match(/\s+/g)||[]," "!==i[a].charAt(0)&&f.unshift(""),p=[],l=0,d=u.length;d>l;l++)t!==n&&(u[l]=s.transpose(u[l],t,n)),p.push({space:f[l],chord:u[l]});r.lines.push({chords:p,text:i[a+1]})}g.push(r)}}),g}function h(e,t,n){e.forEach(function(e){e.lines.forEach(function(e){e.chords.forEach(function(o,r){var i=s.transpose(o.chord,t,n);void 0!==e.chords[r+1]&&(e.chords[r+1].spaces+=o.chord.length-i.length),o.chord=i})})})}var m,v=u._,y=t.sets,S=t.songs,b=t.songSlide={to:"left"},C=t.viewSlide={to:"left"};t.r=n,t.p=function(e){o.path(e)},t.q=function(e,t){o.search(e,t)},t._=v,e.s=r.settings,e.nextSong=function(){var e,t,r=n.setId,i=n.songId;r&&i&&(e=y[r].songs,e.forEach(function(e,n){e._id==i&&(t=n)}),e.length-1>t?t++:t=0,o.path("/set/"+r+"/"+e[t]._id))},e.prevSong=function(){var e,t,r=n.setId,i=n.songId;r&&i&&(e=y[r].songs,e.forEach(function(e,n){e._id==i&&(t=n)}),t>0?t--:t=e.length-1,o.path("/set/"+r+"/"+e[t]._id))},e.getKeys=function(){return n.songId&&S[n.songId]&&s.getKeys("m"===S[n.songId].key.slice(-1))||[]},e.pad=i.pad,e.trashSet=function(){o.path("/"),y.remove(n.setId)},e.duplicateSet=function(){var e=y[n.setId];o.path("set/"+y.save({title:e.title+" ("+v.copy+")",songs:e.songs.slice(0)})+"/")},e.rmSong=function(t){var r=n.setId,i=y[r],a=i.songs;o.path("set/"+r+"/"),a.splice(t,1),a.length?y.save(i):e.trashSet()},e.curKey=function(){var e=n.songId;return e&&S.getKey(e,n.setId)},e.updateKey=function(e){var t,o,r,i=n.setId,a=n.songId,s=S[a];i?(t=y[i],o=t.songs[a],r=o.key||s.key,e!==s.key?o.key=e:delete o.key,y.save(t)):(r=s.userKey||s.key,s.userKey=e),h(b.model,r,e)},e.sortSet=function(e,t){i.move(y,e,t);var n=f.me();i.move(n.sets,e,t),f.save(n)},e.sortSong=function(e,t){var o=y[n.setId];i.move(o.songs,e,t),y.save(o)},e.isSongOwner=function(){return n.songId&&S.isOwner(S[n.songId])},e.editSong=function(e){o.search("edit",e?"clone":void 0),p("new")},e.$on("$routeChangeSuccess",function(t,n,r){if("/"===o.path())return y.length?o.path("sets/"):o.path("search/"),void 0;if(n){var i,a,s,u,l=n.params.view,f=n.params.setId,p=n.params.songId;if(r&&(i=r.params.view,a=r.params.setId,s=r.params.songId),l){if(-1==["sets","catalog","search"].indexOf(l))return y.length?o.path("sets/"):o.path("search/"),void 0;a?(C.to="right",C.model=l):l!=i&&(C.to="left",C.model=l)}if(f){if(!y[f])return y.length?o.path("sets/"):o.path("search/"),void 0;f!=a&&(C.force=!0,C.to="left",C.model="set")}if(p){if(!S[p])return o.path(l+"/"),void 0;u=g(S[p].body,S[p].key,S.getKey(p,f)),e.k=e.curKey(),r?p!==s&&(a&&a===f&&y[f].songs.indexOf(p)<y[f].songs.indexOf(s)?(b.to="right",b.model=u):(b.to="left",b.model=u)):(b.to="left",b.model=u)}else s&&c.apply("song-view",function(){b.model=""});d.set("path",o.path())}}),a.on(["left","k"],function(){return e.$apply(function(){e.prevSong()}),!1}).on("c",function(){return e.$apply(function(){r.toggle("hideChords")}),!1}).on("=",function(){var t=r.settings.fontSize||0;2>t&&(r.set("fontSize",t+1),e.$apply())}).on("-",function(){var t=r.settings.fontSize||0;t&&(r.set("fontSize",t-1),e.$apply())}),m=d.get("path"),"/"==o.path()&&m?o.path(m):e.$emit("$routeChangeSuccess",{params:n})}]),app.directive("editor",["$window","util","parse",function(e,t,n){var o=e.document,r=e.setTimeout,i=e.clearTimeout;return{restrict:"E",replace:!0,transclude:!0,scope:{mode:"&",placeholder:"@",model:"="},template:'<div class="editor"><div class="editor-inner"><div></div><span class="hide"></span><textarea class="input" placeholder="{{placeholder}}" ng-model="model" ng-transclude></textarea></div></div>',link:function(e,a){a=a.children()[0];var s,c=a.children,u=c[0],l=t.element(c[1]),d=c[2],f=e.mode(),p=t.throttle,g=0,h=function(){var e=d.selectionStart||0;e!=g&&(l.attr("pad",d.value.substr(0,e)).removeClass("hide"),g=e)},m=function(){var e=o.createElement("div");h(),n(d.value,f,function(t,n){var r;n&&"chords"!=n?(r=e.appendChild(o.createElement("span")),r.className=n):r=e,r.appendChild(o.createTextNode(t))}),a.replaceChild(e,u),u=e};t.element(d).bind("input",p(m,10)).bind("focus",function(){(function e(){h(),i(s),s=r(e,100)})()}).bind("blur",function(){i(s),l.addClass("hide"),g=null}),r(m,50)}}}]),app.directive("spFocus",["$timeout","util",function(e){function t(e){if(e&&0!==e.length){var t=(""+e).toLowercase;e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}return function(n,o,r){function i(){e(function(){a.focus()},400)}var a=o[0];0===r.spFocus.length?i():n.$watch(r.spFocus,function(e){t(e)&&a.focus()})}}]),app.directive("spIf",function(){return{transclude:"element",priority:1e3,terminal:!0,compile:function(e,t,n){return function(e,t,o){var r,i;e.$watch(o.spIf,function(o){r&&(r.remove(),r=void 0),i&&(i.$destroy(),i=void 0),o&&(i=e.$new(),n(i,function(e){r=e,t.after(e)}))})}}}}),app.directive("img",function(){return{restrict:"E",link:function(e,t){t.bind("error",function(){t.addClass("hide")}),t.bind("load",function(){t.removeClass("hide")})}}}),app.directive("spNotifier",["util","notifier","transitioner","$compile","touch","$timeout",function(e,t,n,o,r,i){return{link:function(a,s){function c(t){function c(){l.removeClass("tl"),n.after(l,function(){l.remove(),f.$destroy(),l=f=null})}var l,d,f=a.$new();e.extend(f,t),l=e.element(s.prepend(u).children()[0]),o(l.contents())(f),i(function(){l.addClass("tl")}),d=i(c,t.delay||5e3),r.tap(l,function(){i.cancel(d),c()})}var u='<div class="notification"><article ng-class="\'icon-\'+icon"><h6>{{title}}</h6><p>{{message}}</p></article></div>';t.setCallback(c).get().forEach(c)}}}]),app.directive("spParse",["touch","util",function(){return function(e,t,n){var o=e.$eval(n.spParse),r=t.find("div"),i=t.find("textarea"),a=function(){var e=i.val();r.html(o(e)||"")};i.bind("keyup",a)}}]),app.directive("select",["util",function(){return{restrict:"E",link:function(e,t){t.wrap('<span class="'+t[0].className+' select"/>')[0].className=""}}}]),app.directive("spSlide",["util","transitioner",function(e,t){return{transclude:"element",priority:1e3,terminal:!0,compile:function(e,n,o){return function(e,r){var i,a,s,c=n.spSlide,u=r.parent();u.addClass("t3d"),e.$watch(function(e){var n,l=e.$eval(c);!l.model&&s&&(a.remove(),i.$destroy(),a=i=s=null),l.model&&(l.model!=s||l.force)&&(l.force=!1,n=e.$new(),n.model=l.model,o(n,function(e){if(r.after(e),a){var o=a,c=i;"left"==l.to?(e.addClass("tr"),u.addClass("transition tl")):(e.addClass("tl"),u.addClass("transition tr")),a.bind("$destroy",function(){u.removeClass("transition tl tr"),e.removeClass("tr tl")}),t.apply(u[0].id,function(){o.remove(),c.$destroy()})}a=e,i=n,s=l.model}))})}}}}]),app.directive("spSortable",["touch","$timeout","util",function(e,t,n){function o(e){var t=0;do t+=e.prop("offsetTop")-e.prop("scrollTop"),e=n.element(e.prop("offsetParent"));while(void 0!==e.prop("offsetTop"));return t}function r(){c&&c.css("margin",""),d.length>s+1&&(c=d.eq(s+1),c.css("marginTop",u-1+"px"))}var i,a,s,c,u,l,d,f,p,g,h=Math.min,m=Math.max;return function(n,v,y){e.hold(v,function(e,n){e.preventDefault(),d=v.children();var c=d.eq(0);g=o(v),l=c.prop("offsetTop")-c.prop("scrollTop"),u=d[0].offsetHeight-1,p=u*d.length,f=h(m(0,n.y-g-l),p),a=s=h(Math.floor(f/u),d.length-1),i=d.eq(a),i.addClass("dragged").css("top",h(m(f+l-u/2,0),p-u/2)+"px"),t(function(){v.addClass("sorting")},0,!1),r()}).drag(v,function(e,t){e.preventDefault(),g=o(v);var n=h(m(0,t.y-g-l),p);if(i.css("top",h(m(n+l-u/2,l),p-u/2-l)+"px"),s!==h(Math.floor(n/u),d.length-1)){var a=Math.round(n/u);a!==s&&a!==s+1&&(a>s?(d.splice(a-1,0,d.splice(s,1)[0]),s=a-1):(d.splice(a,0,d.splice(s,1)[0]),s=a),r())}}).release(v,function(e){e.preventDefault(),v.removeClass("sorting"),c.css("margin",""),i.removeClass("dragged").css("top",""),n.$apply(y.spSortable+"("+a+","+s+")")})}}]),app.directive("spTap",["touch","keyboard",function(e,t){return function(n,o,r){e.tap(o,function(){return n.$apply(r.spTap)}),r.spKbd&&t.on(n.$eval(r.spKbd),function(){return n.$apply(r.spTap)})}}]),app.value("songMode",{startState:function(){return{next:"part"}},token:function(e,t){var n=null;return"part"==t.next?e.match(/^\[[1-9bcpio]\](?=$|\n)/)?(n="part",t.next="chords"):e.skip():"chords"==t.next?e.eat("\n")?(n="chords",t.next="chord"):e.skip():"chord"==t.next?e.eat("\n")?t.next="text":e.eatWhile(" ")?/^[A-G]$/.test(e.peek())||e.skip():e.match(/^[A-G][#b12345679adgijmsu,\(\)]*(?:\/[A-G][#b]?)?(?=($| +|\n))/)?n="chord":e.skip():"text"==t.next?e.match(/^.+\S/)?(n="text",t.next="partOrChords"):e.skip():"partOrChords"==t.next?e.match(/^\n+(?=\[)/)?t.next="part":e.eat("\n")?(n="chords",t.next="chord"):e.skip():e.skip(),n}}),app.factory("auth",["$rootScope","$http","store","$window",function(e,t,n,o){function r(){return!!u}function i(){t.defaults.headers.common.Authorization=r()?"Kinvey "+u:"Basic "+o.btoa(s.key+":"+s.secret)}function a(o,r,a){t.post(s.url+"login",{username:o,password:r}).success(function(t){u=t._kmd.authtoken,c=t,delete c._kmd.authtoken,n.set("me",c),n.set("token",u),i(),e.$emit("login"),a(!0,c)}).error(function(e){a(!1,e)})}var s={},c=n.get("me"),u=n.get("token"),l={setup:function(e){for(var t in e)s[t]=e[t];i()},isLoggedIn:r,reset:function(e,n){t.post(s.url,{username:e}).error(function(e){n(!1,e)}).success(function(){n(!0)})},login:a,logout:function(){t.post(s.url+"_logout"),c=u=null,n.remove("me"),i(),e.$emit("logout")},id:function(){return c&&c._id},me:function(){return c},save:function(e){return n.set("me",c=e),t.put(s.url+encodeURIComponent(c._id),e)}};return l}]),app.factory("collection",["store","auth","$http","$timeout","util",function(e,t,n,o,r){var i=function(e){return e._kmd&&e._kmd.lmt&&Date.parse(e._kmd.lmt)||0},a=function(t){function n(e,t){(a.interval||t)&&(a.syncDown(function(){a.syncUp(null,e||r.noop)}),o(n,a.interval))}var i,a=this;return i=e.get(a.url),i&&(a.pending=e.get(a.url+":pending")||[],a.add(i,t,!0)),n(t,!0),a},s=function(e){var t=this;return n.get(r.buildUrl(t.url,t.params)).success(function(e){e.forEach(function(e){var n=e._id;t[n]?t.saveLocal(e):t.add(e,null,!0)}),t.store()}).success(e||r.noop).error(e||r.noop),t},c=function(e,t){var o=this,a=o.pending.length;return a?(o.pending.forEach(function(s){var c=i(o[s]);n({method:c?"PUT":"POST",url:o.url+(c?encodeURIComponent(s):""),data:o[s]||{_id:s,status:"trash"}}).success(function(n){o[s]&&o.saveLocal(n),r.unlist(o.pending,s),e&&e(s),!--a&&t&&t()}).error(function(){!--a&&t&&t()})}),o):(t&&t(),o)},u=function(e,t){var o=this;return n.get(o.url+e).success(function(e){o.add(e,t)}),o},l=function(e,t){var o=this;return n.get(r.buildUrl(o.url,e)).success(function(e){o.add(e,t)}).error(function(){t&&t()}),o},d=function(e){var t=this,n=e._id;"trash"==e.status?t.removeLocal(n):r.extend(t[n],e)},f=function(e,t,n){var o,a,s=this;r.toArray(e).forEach(function(e){"trash"!=e.status&&(s[e._id]||(s.isNeeded(e)?(s.push(e),a=i(e),a>s.lmt&&(s.lmt=a,s.params.query["_kmd.lmt"].$gt=new Date(a).toISOString()),o=!0):s.aux.push(e)),s[e._id]=e)}),!n&&o&&s.store(),t&&t.call(s,e)},p=function(e){var t=this;r.unlist(t,t[e]),delete t[e],r.unlist(t.pending,e)},g=function(e){var t=this;return t[e].status="trash",r.unlist(t,t[e]),t.save(t[e],function(){t.removeLocal(e)})},h=function(e,n){var o=this,i=e._id;if(i||(i=e._id=r.generateId(),e.created=(new Date).toISOString(),e._acl||(e._acl={}),e._acl.creator=t.id(),!o.onNew||o.onNew(e)))return o[i]?r.extend(o[i],e):o.push(o[i]=e),r.list(o.pending,i),o.syncUp(n||function(){o.store()}),i},m=function(e){var t=this,n=t[e];return n&&!~t.indexOf(n)&&t.push(n),t.store()},v=function(){var t=this;return e.set(t.url,t),e.set(t.url+":pending",t.pending),t},y=function(){var t=this;return e.remove(t.url).remove(t.url+":pending"),t},S=function(e){return e._acl.creator==t.id()},b=function(e){return this[e]._acl.creator},C=function(e,t){var n=this,o=n[e]._acl.r;return o||(o=n[e]._acl.r=[]),r.list(o,t),n},w=function(e,t){var n=this,o=n[e]._acl.w;return o||(o=n[e]._acl.w=[]),r.list(o,t),n},$=function(e,t){var n=this,o=n[e]._acl.r;return o&&r.unlist(o,t),n},k=function(e,t){var n=this,o=n[e]._acl.w;return o&&r.unlist(o,t),n},E=function(e){var t=this[e]._acl;return t&&t.r||[]},A=function(e){var t=this[e]._acl;return t&&t.w||[]},x=function(e,t){var n=this,o=n[e]._acl;return o.r=t,n},D=function(e,t){var n=this,o=n[e]._acl;return o.w=t,n};return function(e){var t,n=[],o={url:"",run:a,save:h,remove:g,isOwner:S,getOwner:b,syncDown:s,addWriter:w,addReader:C,removeWriter:k,removeReader:$,getReaders:E,getWriters:A,setReaders:x,setWriters:D,add:f,saveLocal:d,removeLocal:p,params:{},interval:0,lmt:0,aux:[],pending:[],query:l,get:u,keep:m,syncUp:c,store:v,deleteStore:y,isNeeded:function(){return!0}};return r.extend(n,o,e),t=n.params,t.query=t.query||{},t.query["_kmd.lmt"]={$gt:"0"},n}}]),app.factory("keyboard",["$document","$timeout",function(e,t){function n(e){var n,o,r,a=e.keyCode,s=e.type;if((93==a||224==a)&&(a=91),a>95&&106>a&&(a-=48),110==a&&(a=190),109==a&&(a=189),111==a&&(a=191),"keyup"==s&&(r=u.indexOf(a),-1!==r&&u.splice(r,1)),n=e.target,3==n.nodeType&&(n=n.parentNode),"INPUT"==n.tagName||"SELECT"==n.tagName||"TEXTAREA"==n.tagName||n.contentEditable&&"true"==n.contentEditable){if(27!=a)return;n.blur()}if("keydown"==s){if(-1!==u.indexOf(a))return;u.push(a),i&&t.cancel(i),i=t(function(){u.length=0},1e3,!1)}o=c[s+":"+u.join("+")],o&&o.forEach(function(t){t(e)===!1&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0)})}function o(e,t){var n=[],o="+"===e?["+"]:e.split("+");return o.forEach(function(e){s[e]&&(n.push(16),e=s[e]),a[e]&&n.push(a[e])}),t+":"+n.join("+")}function r(e,t){var n,r;for(r in e)n=o(r,t),c[n]||(c[n]=[]),c[n].push(e[r])}var i,a={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,control:17,alt:18,option:18,capslock:20,esc:27,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,insert:45,del:46,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,"super":91,windows:91,"*":106,"+":107,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={},u=[];e.bind("keydown",n),e.bind("keyup",n);var l={on:function(){var e=arguments,t=e[0],n=e[2],o={};return"string"==typeof t?o[t]=e[1]:Array.isArray(t)?t.forEach(function(t){o[t]=e[1]}):(o=e[0],n=e[1]),r(o,n||"keydown"),this},off:function(e,t){var n=o(e,t);return c[n]&&delete c[n],this},reset:function(){return c={},this}};return l}]),app.factory("locale",function(){var e={};return e.langs=[{code:"cs",name:"Czech","native":"Česky"},{code:"da",name:"Danish","native":"Dansk"},{code:"de",name:"German","native":"Deutsch"},{code:"en",name:"English","native":"English"},{code:"es",name:"Spanish","native":"Español"},{code:"fr",name:"French","native":"Français"},{code:"it",name:"Italian","native":"Italiano"},{code:"lv",name:"Latvian","native":"Latviešu"},{code:"lt",name:"Lithuanian","native":"Lietuvių"},{code:"hu",name:"Hungarian","native":"Magyar"},{code:"nl",name:"Dutch","native":"Nederlands"},{code:"no",name:"Norwegian","native":"Norsk"},{code:"pl",name:"Polish","native":"Polski"},{code:"pt",name:"Portuguese","native":"Português"},{code:"ro",name:"Romanian","native":"Română"},{code:"sq",name:"Albanian","native":"Shqip"},{code:"sk",name:"Slovak","native":"Slovenčina"},{code:"sl",name:"Slovene","native":"Slovenščina"},{code:"fi",name:"Finnish","native":"Suomi"},{code:"sv",name:"Swedish","native":"Svenska"},{code:"tr",name:"Turkish","native":"Türkçe"},{code:"el",name:"Greek","native":"Ελληνικά"},{code:"bg",name:"Bulgarian","native":"български"},{code:"ru",name:"Russian","native":"Pусский"},{code:"uk",name:"Ukrainian","native":"Українська"}],e._={newSong:"New Song",editSong:"Edit Song",addToSet:"Add to Set",renameSet:"Rename Set",shareSet:"Share Set",settings:"Settings",noConnection:"Could not connect to the server!",outOfSync:"SongPane is out of sync. Please make sure you have an active internet connection.",quotaExceeded:"The local storage limit has been reached or local storage is disabled.",alert:"Alert",copy:"copy",keyboard:"Keyboard Shortcuts",illegalOperation:"You tried to perform an illegal operation!",key:"Key",currentKey:"Current Key",originalKey:"Original Key",tempo:"Tempo",signature:"Signature",timeSignature:"Time Signature",artist:"Artist(s)",copyright:"Copyright",profile:"Profile",buddies:"Buddies",remove:"Remove",owner:"Owner",save:"Save",add:"Add",addToNewSet:"Add the song to a new set",addToExistingSet:"or an existing set",selectSet:"Select a set",hideChords:"Hide chords",disconnect:"Disconnect",disconnectAccount:"Disconnect account",songTitle:"Song title",lyricsAndChords:"Lyrics and chords",nameSet:"Give this set a name",done:"Done",email:"Email",enterEmail:"Enter an email address",password:"Password",createAccount:"Create Account",resetPassword:"Reset Password",searchSongs:"Search songs",sets:"Sets",catalog:"Catalog",search:"Search",noSets:"No Sets",creatingSets:"Sets are created by adding songs to them.",emptyCatalog:"Empty Catalog",aboutCatalog:"The catalog contains all the songs that you use or songs that you add to SongPane.",noResults:"No Results",searching:"Searching...",wait:"Wait...",standalone:"To enjoy this app to the fullest we recommend adding it to your Home Screen.",loggedOut:"You have been logged out.",notFound:"The resource was not found on the server.",genericError:"Something went wrong and it’s probably our fault.",confirm:"Are you sure?",explainDelSong:"Deleting the song makes it unavailable to any set that is currently using it!",del:"Delete",cancel:"Cancel",nextSongOrSet:"Next song or set",prevSongOrSet:"Previous song or set",toggleChords:"Toggle chord display",changeFontSize:"Decrease/increase font size",fontSize:"Font size",small:"Small",medium:"Medium",large:"Large",priv:"Private",pub:"Public",language:"Language",visibility:"Visibility",toggleFullscreen:"Toggle fullscreen",toggleInfo:"Toggle song info",toggleHelp:"Toggle help (this screen)",toggleSettings:"Toggle settings",esc:"Cancel actions, close modal windows",checkBody:"Please check the body of the song.",invalidCredentials:"Invalid credentials!",SPInvalidData:"The data you submitted was invalid.",SPOperationNotPermitted:"You are trying to perform an illegal operation.",SPInvalidQuery:""},e}),app.factory("md5",function(){function e(e,t){var a=e[0],s=e[1],c=e[2],u=e[3];a=n(a,s,c,u,t[0],7,-680876936),u=n(u,a,s,c,t[1],12,-389564586),c=n(c,u,a,s,t[2],17,606105819),s=n(s,c,u,a,t[3],22,-1044525330),a=n(a,s,c,u,t[4],7,-176418897),u=n(u,a,s,c,t[5],12,1200080426),c=n(c,u,a,s,t[6],17,-1473231341),s=n(s,c,u,a,t[7],22,-45705983),a=n(a,s,c,u,t[8],7,1770035416),u=n(u,a,s,c,t[9],12,-1958414417),c=n(c,u,a,s,t[10],17,-42063),s=n(s,c,u,a,t[11],22,-1990404162),a=n(a,s,c,u,t[12],7,1804603682),u=n(u,a,s,c,t[13],12,-40341101),c=n(c,u,a,s,t[14],17,-1502002290),s=n(s,c,u,a,t[15],22,1236535329),a=o(a,s,c,u,t[1],5,-165796510),u=o(u,a,s,c,t[6],9,-1069501632),c=o(c,u,a,s,t[11],14,643717713),s=o(s,c,u,a,t[0],20,-373897302),a=o(a,s,c,u,t[5],5,-701558691),u=o(u,a,s,c,t[10],9,38016083),c=o(c,u,a,s,t[15],14,-660478335),s=o(s,c,u,a,t[4],20,-405537848),a=o(a,s,c,u,t[9],5,568446438),u=o(u,a,s,c,t[14],9,-1019803690),c=o(c,u,a,s,t[3],14,-187363961),s=o(s,c,u,a,t[8],20,1163531501),a=o(a,s,c,u,t[13],5,-1444681467),u=o(u,a,s,c,t[2],9,-51403784),c=o(c,u,a,s,t[7],14,1735328473),s=o(s,c,u,a,t[12],20,-1926607734),a=r(a,s,c,u,t[5],4,-378558),u=r(u,a,s,c,t[8],11,-2022574463),c=r(c,u,a,s,t[11],16,1839030562),s=r(s,c,u,a,t[14],23,-35309556),a=r(a,s,c,u,t[1],4,-1530992060),u=r(u,a,s,c,t[4],11,1272893353),c=r(c,u,a,s,t[7],16,-155497632),s=r(s,c,u,a,t[10],23,-1094730640),a=r(a,s,c,u,t[13],4,681279174),u=r(u,a,s,c,t[0],11,-358537222),c=r(c,u,a,s,t[3],16,-722521979),s=r(s,c,u,a,t[6],23,76029189),a=r(a,s,c,u,t[9],4,-640364487),u=r(u,a,s,c,t[12],11,-421815835),c=r(c,u,a,s,t[15],16,530742520),s=r(s,c,u,a,t[2],23,-995338651),a=i(a,s,c,u,t[0],6,-198630844),u=i(u,a,s,c,t[7],10,1126891415),c=i(c,u,a,s,t[14],15,-1416354905),s=i(s,c,u,a,t[5],21,-57434055),a=i(a,s,c,u,t[12],6,1700485571),u=i(u,a,s,c,t[3],10,-1894986606),c=i(c,u,a,s,t[10],15,-1051523),s=i(s,c,u,a,t[1],21,-2054922799),a=i(a,s,c,u,t[8],6,1873313359),u=i(u,a,s,c,t[15],10,-30611744),c=i(c,u,a,s,t[6],15,-1560198380),s=i(s,c,u,a,t[13],21,1309151649),a=i(a,s,c,u,t[4],6,-145523070),u=i(u,a,s,c,t[11],10,-1120210379),c=i(c,u,a,s,t[2],15,718787259),s=i(s,c,u,a,t[9],21,-343485551),e[0]=l(a,e[0]),e[1]=l(s,e[1]),e[2]=l(c,e[2]),e[3]=l(u,e[3])}function t(e,t,n,o,r,i){return t=l(l(t,e),l(o,i)),l(t<<r|t>>>32-r,n)}function n(e,n,o,r,i,a,s){return t(n&o|~n&r,e,n,i,a,s)}function o(e,n,o,r,i,a,s){return t(n&r|o&~r,e,n,i,a,s)}function r(e,n,o,r,i,a,s){return t(n^o^r,e,n,i,a,s)}function i(e,n,o,r,i,a,s){return t(o^(n|~r),e,n,i,a,s)}function a(t){var n,o=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(n=64;t.length>=n;n+=64)e(r,s(t.substring(n-64,n)));t=t.substring(n-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;t.length>n;n++)i[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(e(r,i),n=0;16>n;n++)i[n]=0;return i[14]=8*o,e(r,i),r}function s(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function c(e){for(var t="",n=0;4>n;n++)t+=f[15&e>>8*n+4]+f[15&e>>8*n];return t}function u(e){for(var t=0;e.length>t;t++)e[t]=c(e[t]);return e.join("")}function l(e,t){return 4294967295&e+t}function d(e){return u(a(e||""))}var f="0123456789abcdef".split("");return d}),app.factory("modal",["$rootScope","$location","$routeParams","transitioner","$timeout",function(e,t,n,o,r){function i(e){t.search("modal",e||null)}var a=function(t){return e.modalClass?(e.modalClass="",o.apply("modal",function(){i(),t!=n.modal&&r(function(){i(t)})})):t&&i(t),!0};return a.isOn=function(t){return t?e.modalClass===t:e.modalClass},a}]),app.factory("notifier",function(){var e,t={title:"",icon:"info",delay:5e3},n=[],o=Object.keys;return{setCallback:function(t){return e=t,this},notify:function(r){return o(t).forEach(function(e){r[e]||(r[e]=t[e])}),n.push(r),e&&e(r),this},get:function(){return n}}}),app.factory("parse",["$window",function(){function e(e){var t=this;t.pos=t.start=0,t.string=e}return e.prototype={eof:function(){return this.pos>=this.string.length},sof:function(){return!this.pos},eol:function(){return this.pos>=this.string.length||"\n"==this.string.charAt(this.pos)},sol:function(){return!this.pos||"\n"==this.string.charAt(this.pos-1)},peek:function(){return this.string.charAt(this.pos)||null},next:function(){return this.pos<this.string.length&&this.string.charAt(this.pos++)},eat:function(e){var t,n=this.string.charAt(this.pos);return t="string"==typeof e?n==e:n&&(e.test?e.test(n):e(n)),t?(++this.pos,n):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skip:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return~t?(this.pos=t,!0):void 0},skipLine:function(){return this.skipTo("\n")&&this.pos<this.string.length&&++this.pos},backUp:function(e){this.pos-=e},column:function(){return this.start},match:function(e,t){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&t!==!1&&(this.pos+=n[0].length),n}return this.string.indexOf(e,this.pos)==this.pos?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},function(t,n,o){var r,i,a=n.startState()||!0;for(r=new e(t);!r.eof();)i=n.token(r,a),o(r.current(),i),r.start=r.pos}}]),function(){var e,t=navigator.userAgent;/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t)?e="ios":~t.toLowerCase().indexOf("firefox")&&(e="ff"),e&&(document.documentElement.className+=" "+e),app.constant("platform",e)}(),app.factory("settings",["store","util",function(e,t){var n={},o=function(t,o){n[t]=o,e.set("settings",n)};return t.extend(n,e.get("settings")||{}),{settings:n,set:o,toggle:function(e){o(e,!n[e])}}}]),app.service("store",["notifier","$window","locale",function(e,t,n){var o=t.localStorage,r=this;r.set=function(t,r){try{o.setItem(t,JSON.stringify(r))}catch(i){e.notify({message:n.quotaExceeded})}return r},r.get=function(e){return JSON.parse(o.getItem(e))},r.remove=function(e){return o.removeItem(e),r}}]),app.factory("touch",["$window","$timeout",function(e,t){function n(e){return S&&(e=e.touches[0]||e.changedTouches[0]),{x:e.pageX,y:e.pageY}}function o(e){var t=n(e);return t.dx=t.x-m.x,t.dy=t.y-m.y,t}function r(e,t){return k($(t.x-e.x,2)+$(t.y-e.y,2))}function i(e){p=!0,m=n(e),g=e.target,v=t(function(){c("hold",m,e),h=!0},1e3)}function a(e){p&&(h?c("drag",o(e),e):t.cancel(v))}function s(e){p&&(t.cancel(v),h?c("release",o(e),e):10>r(n(e),m)&&c("tap",e),g=p=h=!1)}function c(e,t,n){for(var o,r,i=g;i&&i!=b&&(o=i.parentNode,r=C.indexOf(i),-1==r||!w[r][e]||!1!==w[r][e](n,t));)i=o}function u(e,t,n){t.length&&(t=t[0]);var o=C.indexOf(t);-1==o&&(o=C.push(t)-1,w[o]={}),w[o][e]=n}var l,d,f,p,g,h,m,v,y={},S="ontouchstart"in e,b=e.document,C=[],w=[],$=Math.pow,k=Math.sqrt;return S?(l="touchstart",d="touchmove",f="touchend"):(l="mousedown",d="mousemove",f="mouseup"),b.addEventListener(l,i,!0),b.addEventListener(d,a,!0),b.addEventListener(f,s,!0),["tap","hold","drag","release"].forEach(function(e){y[e]=function(t,n){return u(e,t,n),this}}),y}]),app.factory("transitioner",["$rootScope","$document","util",function(e,t,n){function o(){var e,n=t[0].createElement("dummy"),o={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in o)if(void 0!==n.style[e])return o[e]}var r=o(),i={},a=[];return r&&t.bind(r,function(t){var n=t.target.id;if(n&&n in i){for(;i[n].length;)e.$apply(i[n].shift());delete i[n]}}),{apply:function(e,t,n){return r?(e in i&&!n||(i[e]=[]),i[e].push(t),void 0):(t(),void 0)},after:function(e,t,o){e[0]&&(e=e[0]),e.id||(e.id=n.generateId()),this.apply(e.id||a.push(e)-1,t,o)
}}}]),app.factory("transposer",function(){var e=/C#|D#|E#|F#|G#|A#|B#|Cb|Db|Eb|Fb|Gb|Ab|Bb|C|D|E|F|G|A|B/g,t=[["C","C#","Db","D","Eb","E","F","F#","Gb","G","Ab","A","Bb","B","Cb"],["Am","A#m","Bbm","Bm","Cm","C#m","Dm","D#m","Ebm","Em","Fm","F#m","Gm","G#m","Abm"]],n=[["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],["C#","D","D#","E","E#","F#","G","G#","A","A#","B","B#"],["Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B","C"],["D","D#","E","F","F#","G","G#","A","A#","B","C","C#"],["Eb","E","F","Gb","G","Ab","A","Bb","B","C","Db","D"],["E","F","F#","G","G#","A","A#","B","C","C#","D","D#"],["F","Gb","G","Ab","A","Bb","B","C","Db","D","Eb","E"],["F#","G","G#","A","A#","B","C","C#","D","D#","E","E#"],["Gb","G","Ab","A","Bb","B","C","Db","D","Eb","E","F"],["G","G#","A","A#","B","C","C#","D","D#","E","F","F#"],["Ab","A","Bb","B","C","Db","D","Eb","E","F","Gb","G"],["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],["Bb","B","C","Db","D","Eb","E","F","Gb","G","Ab","A"],["B","C","C#","D","D#","E","F","F#","G","G#","A","A#"],["Cb","C","Db","D","Eb","Fb","F","Gb","G","Ab","A","Bb"]];return{getKeys:function(e){return t[Number(e)]},getAllKeys:function(){return t[0].concat(t[1])},getScale:function(e){return n[t["m"===e.slice(-1)?1:0].indexOf(e)]},transpose:function(o,r,i){var a="m"===r.slice(-1)?1:0,s=t[a].indexOf(r),c=t[a].indexOf(i);return o.replace(e,function(e){return n[c][n[s].indexOf(e)]})}}}),function(e,t){app.service("util",["$window",function(n){var o=this,r=n.document,i=n.setTimeout,a=n.clearTimeout;o.toArray=function(e){return e&&e.forEach?e:[e]},o.list=function(e,t){var n=e.length;return o.toArray(t).forEach(function(t){var n=e.indexOf(t);~n||e.push(t)}),e.length-n},o.unlist=function(e,t){var n=e.indexOf(t);return~n&&e.splice(n,1),e.length},o.move=function(e,t,n){return e.splice(n,0,e.splice(t,1)[0]),e},o.pad=function(e){return Array(e+1).join(" ")},o.buildUrl=function(n,r){if(!r)return n;var i=[];return e.forEach(r,function(n,r){null!==n&&n!==t&&(e.isObject(n)&&(n=o.toJson(n)),i.push(encodeURIComponent(r)+"="+encodeURIComponent(n)))}),n+(-1==n.indexOf("?")?"?":"&")+i.join("&")},o.element=function(t){return e.isString(t)&&(t=r.getElementById(t)),e.element(t)},o.randomHex=function(e){for(var t="";e>0;)t+=Math.floor(Math.random()*Math.pow(10,16)).toString(16).substr(0,8>e?e:8),e-=8;return t},o.generateId=function(){return Math.floor(Date.now()/1e3).toString(16)+o.randomHex(16)},o.throttle=function(e,t){var n=null;return function(){var o=this,r=arguments;a(n),n=i(function(){e.apply(o,r),n=null},t)}},o.toJson=n.JSON.stringify,["copy","extend","forEach","identity","fromJson","isObject","isString","isArray","lowercase","noop"].forEach(function(t){o[t]=e[t]})}])}(angular);