app=angular.module("SongPane",[]),function(e){var t="//api.songpane.com/",n="kid_Ve5MJ5EOhM",o="03910d2676f34fd5bcae148188556e06";e.config(["$routeProvider","$httpProvider",function(e,t){e.when("/").when("/set/:setId/:songId").when("/:view/:songId").otherwise("/"),delete t.defaults.headers.common["X-Requested-With"],t.defaults.headers.common["X-Kinvey-Api-Version"]="2",t.defaults.cache=!1,t.responseInterceptors.push(["$q","$injector","notifier","locale","util",function(e,t,n,o,r){function i(o){var r=o.status;return 0===r?o.data=a.noConnection:401==r?(s=s||t.get("auth"),s.isLoggedIn()&&(s.logout(),n.notify({message:o.data=a.loggedOut,icon:"alert"}))):404==r?n.notify({message:o.data=a.notFound,icon:"alert"}):n.notify({message:o.data=a.genericError,icon:"alert"}),e.reject(o)}var s,a=o._;return function(e){return e.then(r.identity,i)}}])}]).run(["$rootScope","auth","ws","collection","util","transitioner","keyboard","modal","notifier","$window","locale",function(e,r,i,s,a,c,u,l,d,f,p){var g,h,m=f.navigator,v=p._;f.notify=d.notify,r.setup({url:t+"user/"+n+"/",key:n,secret:o}),"standalone"in m&&!m.standalone&&d.notify({message:v.standalone,icon:"songpane"}),e._=v,e.change=!1,e.$on("ready",function(){e.ready=!0}),e.$on("login",function(){e.loginClass="",e.requireLogin&&c.apply("login",function(){e.requireLogin=!1}),i("ws://ws.songpane.com:8000").send("auth",r.token()).on("me",function(e){var t=e.sets;g.sort(function(e,n){return t.indexOf(e._id)-t.indexOf(n._id)}).store(),r.save(e,!0)}),g=e.sets=s({songs:[],isNeeded:function(e){var t=this.songs,n=e.songs;return n.forEach(function(e){var o=e._id;n[o]=e,a.list(t,o)}),!0},getSong:function(e,t){var n,o,r=this[e].songs;for(o=0,n=r.length;n>o;o++)if(r[o]._id==t)return r[o]},url:t+"appdata/"+n+"/set/",params:{query:{_id:{$in:r.me().sets}}},onNew:function(e){var t=r.me(),n=t.sets,o=e._id;return n.push(o),r.save(t),e},hasSong:function(e){return-1!==this.songs.indexOf(e)?!0:!1}}),h=e.songs=s({url:t+"appdata/"+n+"/song/",params:{ids:g.songs},isNeeded:function(e){return i.sub("song."+e._id),this.isOwner(e)||g.hasSong(e._id)?!0:!1},getKey:function(e,t){var n=t&&g.getSong(t,e),o=h[e];return n&&n.key||o.key}}),g.run(function(){h.run(function(){i.on("set",function(t){var n=[],o=r.me();g.update(t),~o.sets.indexOf(t._id)||(d.notify({title:v.sharedSet,message:t.title,icon:"sets"}),o.sets.push(t._id),r.save(o,!0)),g.store(),t.songs.forEach(function(e){h[e._id]||n.push(e._id)}),n.length?h.query({ids:n}):e.$apply()}),i.on("song",function(t){h.update(t),e.$apply()}),e.$emit("ready")})})}),e.$on("logout",function(){e.ready=!1,l(),i.close(),g.deleteStore(),h.deleteStore(),g=h=e.sets=e.songs=null,e.requireLogin=!0}),r.isLoggedIn()?e.$emit("login"):e.requireLogin=!0,e.modal=l,e.toggleState=function(t){e[t]=!e[t],e.changedState=!0},e.resetState=function(){return e.changedState?(e.changedState=!1,undefined):(["menu","em"].forEach(function(t){e[t]&&(e[t]=!1)}),undefined)},u.on("ctrl+shift",function(){e.slow=!e.slow}).on(["h","?"],function(){return l("keyboard"),e.$apply(),!1}).on("esc",function(){return!1})}])}(app),app.controller("addController",["$scope","$routeParams","$rootScope",function(e,t,n){var o=n.sets,r=n.songs;e.s=o.filter(function(e){return o.isWriter(e)}),e.addNew=function(e){var n=t.songId;return r.keep(n),o.save({title:e,songs:[{_id:n}]})},e.addExisting=function(e){var n=t.songId,i=o[e],s=i.songs;return s[n]?!0:(s.push(s[n]={_id:n}),r.keep(n),o.save(i))}}]),app.controller("confirmController",["$scope","$routeParams","$rootScope","util","$location",function(e,t,n,o,r){var i=n.sets,s=n.songs;e.trashSong=function(){var e=t.songId,n=t.setId;return i.forEach(function(t){o.unlist(t.songs,e)||i.remove(t._id)}),r.path((n?"set":t.view)+"/"+(i[n]?n+"/":"")),s.remove(e)}}]),app.controller("loginController",["$scope","auth","locale","md5",function(e,t,n,o){var r=n._;e.login=function(n,o){e.message=r.wait,t.login(n,o,function(t,n){t||(e.message="InvalidCredentials"==n.error?r.invalidCredentials:r.genericError)})},e.reset=function(n){e.message=r.wait,t.reset(n,function(t){e.message=t?r.checkEmail:r.genericError})},e.md5=o,e.message=""}]),app.controller("newController",["$scope","$rootScope","transposer","songMode","$routeParams","util","locale","notifier",function(e,t,n,o,r,i,s,a){var c=t.songs,u=r.edit,l=s._;e.songMode=o,e.langs=s.langs,u&&(e.song=i.extend({},c[r.songId]),"clone"==u&&delete e.song._id,e.song.tempo=e.song.tempo-0),e.saveSong=function(e,t){var o="("+n.getScale(e.key).join("|")+")";return~e.body.search("^(?:\\[[1-9BCPIO]\\]\\n(?:(?: *"+o+"[1-9adgijmsu,\\(\\)]*(?:\\/"+o+")?)*\\n[^\\[\\n].+\\S(?:\\n|$))+)+$")?(e._acl={},t&&(e._acl={gr:!1}),c.save(e)):(a.notify({message:l.checkBody,icon:"alert"}),void 0)},e.keys=n.getAllKeys()}]),app.controller("renameController",["$scope","$rootScope",function(e,t){var n=t.sets;e.renameSet=function(e,t){var o=n[e];return t!==o.title?(o.title=t,n.save(o)):!1}}]),app.controller("searchController",["$scope","$rootScope","locale",function(e,t,n){var o=t.songs;e._=n._,e.message="",e.search=function(t){e.s=e.n=!0,o.query({query:{body:{$regex:t,$options:"i"}},limit:100},function(t){e.results=t,e.s=!1})}}]),app.controller("settingsController",["$scope","auth","settings",function(e,t,n){e.s=n.settings,e.toggle=function(e){n.toggle(e)},e.setFont=function(e){n.set("fontSize",e)},e.logout=function(){return t.logout(),!0}}]),app.controller("shareController",["$scope","$routeParams","$rootScope","md5","util",function(e,t,n,o,r){var i=r.list,s=r.unlist,a=n.sets,c=t.setId,u=e.e=a.getWriters(c).slice(0),l=e.c=a.getReaders(c).slice(0);e.owner=a.getOwner(c),e.md5=o,e.allowAccess=function(e,t){return i(l,e),"edit"==t?i(u,e):s(u,e),!0},e.denyAccess=function(e){s(u,e),s(l,e)},e.isOwner=function(){return a.isOwner(a[c])},e.save=function(){return a.setReaders(c,l).setWriters(c,u).save(a[c])}}]),app.controller("uiController",["$scope","$rootScope","$routeParams","$location","settings","util","keyboard","transposer","transitioner","locale","$timeout","store","auth","ws","modal",function(e,t,n,o,r,i,s,a,c,u,l,d,f,p,g){function h(e,t,n){var o,r,s,c,u,l,d,f,p,g=[];return e.split("[").forEach(function(e){if(""!==e){for(o=e.split("]"),l="",s=o[1].replace(/[\r\t\v\f\0\x0B]|^\n+|\s+$/g,"").split("\n"),c=0,u=s.length;u>c;c+=2){for(r=s[c+1],r.length<s[c].length&&(r+=i.pad(s[c].length-r.length," ")),p=0,d=/\S+/g;f=d.exec(s[c]);)l+=r.substring(p,f.index)+'<span class="c"><span>'+(t!==n?a.transpose(f[0],t,n):f[0])+"</span></span>",p=f.index;l+=s[c+1].substr(p)+"\n"}g.push({type:o[0].toLowerCase(),text:l})}}),g}var m,v=u._,b=t.sets,y=t.songs,S=t.songSlide={to:"left"},C=t.viewSlide={to:"left"};t.r=n,t.p=function(e){o.path(e)},t.q=function(e,t){o.search(e,t)},t._=v,e.s=r.settings,e.nextSong=function(){var e,t,r=n.setId,i=n.songId;r&&i&&(e=b[r].songs,e.forEach(function(e,n){e._id==i&&(t=n)}),e.length-1>t?t++:t=0,o.path("/set/"+r+"/"+e[t]._id))},e.prevSong=function(){var e,t,r=n.setId,i=n.songId;r&&i&&(e=b[r].songs,e.forEach(function(e,n){e._id==i&&(t=n)}),t>0?t--:t=e.length-1,o.path("/set/"+r+"/"+e[t]._id))},e.getKeys=function(){return n.songId&&y[n.songId]&&a.getKeys("m"===y[n.songId].key.slice(-1))||[]},e.pad=i.pad,e.trashSet=function(){o.path("/"),b.remove(n.setId)},e.duplicateSet=function(){var e=b[n.setId];o.path("set/"+b.save({title:e.title+" ("+v.copy+")",songs:e.songs.slice(0)})+"/")},e.rmSong=function(t){var r=n.setId,i=b[r],s=i.songs;o.path("set/"+r+"/"),s.splice(t,1),s.length?b.save(i):e.trashSet()},e.curKey=function(){var e=n.songId;return e&&y.getKey(e,n.setId)},p.on("set",function(t){var o=n.setId,r=n.songId;o==t._id&&t.songs.forEach(function(t){t._id==r&&e.updateKey(t.key||y[r].key,!0)})}),e.updateKey=function(t,o){var r,i,s=n.setId,a=n.songId,c=y[a];s&&(r=b[s],i=b.getSong(s,a),t!==c.key?i.key=t:delete i.key,!o&&b.save(r)),e.k!=t&&(S.model=h(c.body,c.key,t),e.k=t)},e.clean=function(e){delete this[e]},e.sortSet=function(e,t){i.move(b,e,t);var n=f.me();i.move(n.sets,e,t),f.save(n)},e.sortSong=function(e,t){var o=b[n.setId];i.move(o.songs,e,t),b.save(o)},e.isSongOwner=function(){return n.songId&&y.isOwner(y[n.songId])},e.editSong=function(e){o.search("edit",e?"clone":void 0),g("new")},e.canChangeKey=function(){var e=n.setId;return e?b.isWriter(b[e]):!0},e.$on("$routeChangeSuccess",function(t,n,r){if("/"===o.path())return b.length?o.path("sets/"):o.path("search/"),void 0;if(n){var i,s,a,u,l=n.params.view,f=n.params.setId,p=n.params.songId;if(r&&(i=r.params.view,s=r.params.setId,a=r.params.songId),l){if(-1==["sets","catalog","search"].indexOf(l))return b.length?o.path("sets/"):o.path("search/"),void 0;s?(C.to="right",C.model=l):l!=i&&(C.to="left",C.model=l)}if(f){if(!b[f])return b.length?o.path("sets/"):o.path("search/"),void 0;f!=s&&(C.force=!0,C.to="left",C.model="set")}if(p){if(!y[p])return o.path(l+"/"),void 0;u=h(y[p].body,y[p].key,y.getKey(p,f)),e.k=e.curKey(),r?p!==a&&(s&&s===f&&b[f].songs.indexOf(p)<b[f].songs.indexOf(a)?(S.to="right",S.model=u):(S.to="left",S.model=u)):(S.to="left",S.model=u)}else a&&c.apply("song-view",function(){S.model=""});d.set("path",o.path())}}),s.on(["left","k"],function(){return e.$apply(function(){e.prevSong()}),!1}).on("c",function(){return e.$apply(function(){r.toggle("hideChords")}),!1}).on("=",function(){var t=r.settings.fontSize||0;2>t&&(r.set("fontSize",t+1),e.$apply())}).on("-",function(){var t=r.settings.fontSize||0;t&&(r.set("fontSize",t-1),e.$apply())}),m=d.get("path"),"/"==o.path()&&m?o.path(m):e.$emit("$routeChangeSuccess",{params:n})}]),app.directive("editor",["$window","util","parse",function(e,t,n){var o=e.document,r=e.setTimeout,i=e.clearTimeout;return{restrict:"E",replace:!0,transclude:!0,scope:{mode:"&",placeholder:"@",model:"="},template:'<div class="editor"><div class="editor-inner"><div></div><span class="hide"></span><textarea class="input" placeholder="{{placeholder}}" ng-model="model" ng-transclude></textarea></div></div>',link:function(e,s){s=s.children()[0];var a,c=s.children,u=c[0],l=t.element(c[1]),d=c[2],f=e.mode(),p=t.throttle,g=0,h=function(){var e=d.selectionStart||0;e!=g&&(l.attr("pad",d.value.substr(0,e)).removeClass("hide"),g=e)},m=function(){var e=o.createElement("div");h(),n(d.value,f,function(t,n){var r;n&&"chords"!=n?(r=e.appendChild(o.createElement("span")),r.className=n):r=e,r.appendChild(o.createTextNode(t))}),s.replaceChild(e,u),u=e};t.element(d).bind("input",p(m,10)).bind("focus",function(){(function e(){h(),i(a),a=r(e,100)})()}).bind("blur",function(){i(a),l.addClass("hide"),g=null}),r(m,50)}}}]),app.directive("spFocus",["$timeout","util",function(e){function t(e){if(e&&0!==e.length){var t=(""+e).toLowercase;e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}return function(n,o,r){function i(){e(function(){s.focus()},400)}var s=o[0];0===r.spFocus.length?i():n.$watch(r.spFocus,function(e){t(e)&&s.focus()})}}]),app.directive("spIf",function(){return{transclude:"element",priority:1e3,terminal:!0,compile:function(e,t,n){return function(e,t,o){var r,i;e.$watch(o.spIf,function(o){o?r||(i=e.$new(),n(i,function(e){r=e,t.after(e)})):r&&(r.remove(),i.$destroy(),r=i=void 0)})}}}}),app.directive("img",function(){return{restrict:"E",link:function(e,t){t.bind("error",function(){t.addClass("hide")}),t.bind("load",function(){t.removeClass("hide")})}}}),app.directive("spNotifier",["util","notifier","transitioner","$compile","touch","$timeout",function(e,t,n,o,r,i){return{link:function(s,a){function c(t){function c(){f||(f=!0,l.removeClass("tl"),n.after(l,function(){l.remove(),p.$destroy(),l=p=null}))}var l,d,f,p=s.$new();e.extend(p,t),l=e.element(a.prepend(u).children()[0]),o(l.contents())(p),i(function(){l.addClass("tl")}),r.tap(l,c),d=i(c,t.delay||5e3)}var u='<div class="notification"><article ng-class="\'icon-\'+icon"><h6>{{title}}</h6><p>{{message}}</p></article></div>';t.setCallback(c).get().forEach(c)}}}]),app.directive("spParse",["touch","util",function(){return function(e,t,n){var o=e.$eval(n.spParse),r=t.find("div"),i=t.find("textarea"),s=function(){var e=i.val();r.html(o(e)||"")};i.bind("keyup",s)}}]),app.directive("spSlide",["util","transitioner",function(e,t){return{transclude:"element",priority:1e3,terminal:!0,compile:function(e,n,o){return function(e,r){var i,s,a,c=n.spSlide,u=r.parent();u.addClass("t3d"),e.$watch(function(e){var n,l=e.$eval(c);!l.model&&a&&(s.remove(),i.$destroy(),s=i=a=null),l.model&&(l.model!=a||l.force)&&(l.force=!1,n=e.$new(),n.model=l.model,o(n,function(e){if(r.after(e),s){var o=s,c=i;"left"==l.to?(e.addClass("tr"),u.addClass("transition tl")):(e.addClass("tl"),u.addClass("transition tr")),s.bind("$destroy",function(){u.removeClass("transition tl tr"),e.removeClass("tr tl")}),t.apply(u[0].id,function(){o.remove(),c.$destroy()})}s=e,i=n,a=l.model}))})}}}}]),app.directive("spSortable",["touch","$timeout","util",function(e,t,n){function o(e){var t=0;do t+=e.prop("offsetTop")-e.prop("scrollTop"),e=n.element(e.prop("offsetParent"));while(void 0!==e.prop("offsetTop"));return t}function r(){c&&c.css("margin",""),d.length>a+1&&(c=d.eq(a+1),c.css("marginTop",u-1+"px"))}var i,s,a,c,u,l,d,f,p,g,h=Math.min,m=Math.max;return function(v,b,y){v.$watch(y.spSortable,function(S){S||void 0===S?(e.hold(b,function(e,n){e.preventDefault(),d=b.children();var c=d.eq(0);g=o(b),l=c.prop("offsetTop")-c.prop("scrollTop"),u=d[0].offsetHeight-1,p=u*d.length,f=h(m(0,n.y-g-l),p),s=a=h(Math.floor(f/u),d.length-1),i=d.eq(s),i.addClass("dragged").css("top",h(m(f+l-u/2,0),p-u/2)+"px"),t(function(){b.addClass("sorting")},0,!1),r()}),e.drag(b,function(e,t){e.preventDefault(),g=o(b);var n=h(m(0,t.y-g-l),p);if(i.css("top",h(m(n+l-u/2,l),p-u/2-l)+"px"),a!==h(Math.floor(n/u),d.length-1)){var s=Math.round(n/u);s!==a&&s!==a+1&&(s>a?(d.splice(s-1,0,d.splice(a,1)[0]),a=s-1):(d.splice(s,0,d.splice(a,1)[0]),a=s),r())}}),e.release(b,function(e){e.preventDefault(),b.removeClass("sorting"),c.css("margin",""),i.removeClass("dragged").css("top",""),v.$apply(y.onsort+"("+s+","+a+")")})):(e.hold(b,n.noop),e.drag(b,n.noop),e.release(b,n.noop))})}}]),app.directive("spTap",["touch","keyboard",function(e,t){return function(n,o,r){e.tap(o,function(){return n.$apply(r.spTap)}),r.spKbd&&t.on(n.$eval(r.spKbd),function(){return n.$apply(r.spTap)})}}]),app.value("songMode",{startState:function(){return{next:"part"}},token:function(e,t){var n=null;return"part"==t.next?e.match(/^\[[1-9BCPIO]\](?=$|\n)/)?(n="part",t.next="chords"):e.skip():"chords"==t.next?e.eat("\n")?(n="chords",t.next="chord"):e.skip():"chord"==t.next?e.eat("\n")?t.next="text":e.eatWhile(" ")?/^[A-G]$/.test(e.peek())||e.skip():e.match(/^[A-G][#b12345679adgijmsu,\(\)]*(?:\/[A-G][#b]?)?(?=($| +|\n))/)?n="chord":e.skip():"text"==t.next?e.match(/^.+\S/)?(n="text",t.next="partOrChords"):e.skip():"partOrChords"==t.next?e.match(/^\n(?=\[)/)?t.next="part":e.eat("\n")?(n="chords",t.next="chord"):e.skip():e.skip(),n}}),app.factory("auth",["$rootScope","$http","store","$window",function(e,t,n,o){function r(){return!!u}function i(){t.defaults.headers.common.Authorization=r()?"Kinvey "+u:"Basic "+o.btoa(a.key+":"+a.secret)}function s(o,r,s){t.post(a.url+"login",{username:o,password:r}).success(function(t){u=t._kmd.authtoken,c=t,delete c._kmd.authtoken,n.set("me",c),n.set("token",u),i(),e.$emit("login"),s(!0,c)}).error(function(e){s(!1,e)})}var a={},c=n.get("me"),u=n.get("token"),l={setup:function(e){for(var t in e)a[t]=e[t];i()},isLoggedIn:r,reset:function(e,n){t.post(a.url,{username:e}).error(function(e){n(!1,e)}).success(function(){n(!0)})},login:s,logout:function(){t.post(a.url+"_logout"),c=u=null,n.remove("me").remove("token"),i(),e.$emit("logout")},id:function(){return c&&c._id},me:function(){return c},token:function(){return u},save:function(e,o){return n.set("me",c=e),o||t.put(a.url+encodeURIComponent(c._id),e),!0}};return l}]),app.factory("collection",["store","auth","$http","$timeout","util",function(e,t,n,o,r){var i=function(e){return e._kmd&&e._kmd.lmt&&Date.parse(e._kmd.lmt)||0},s=function(t){var n,o=this;return n=e.get(o.url),n&&(o.pending=e.get(o.url+":pending")||[],o.add(n,t,!0)),o.syncDown(function(){o.syncUp(null,t||r.noop)}),o},a=function(e){var t=this;return n.get(r.buildUrl(t.url,t.params)).success(function(e){e.forEach(function(e){t[e._id]?t.saveLocal(e):t.add(e,null,!0)}),t.store()}).success(e||r.noop).error(e||r.noop),t},c=function(e,t){var o=this,i=o.pending.length;return i?(o.pending.forEach(function(s){n({method:"PUT",url:o.url+encodeURIComponent(s),data:o[s]||{_id:s,status:"trash"}}).success(function(n){o[s]&&o.saveLocal(n),r.unlist(o.pending,s),e&&e(s),!--i&&t&&t()}).error(function(){!--i&&t&&t()})}),o):(t&&t(),o)},u=function(e,t){var o=this;return n.get(o.url+e).success(function(e){o.add(e,t)}),o},l=function(e,t){var o=this;return n.get(r.buildUrl(o.url,e)).success(function(e){o.add(e,t)}).error(function(){t&&t()}),o},d=function(e){var t=this;t[e._id]?t.saveLocal(e):t.add(e,null,!0)},f=function(e){var t=this,n=e._id;"trash"==e.status?t.removeLocal(n):r.extend(t[n],e)},p=function(e,t,n){var o,s,a=this;r.toArray(e).forEach(function(e){"trash"!=e.status&&(a[e._id]||(a.isNeeded(e)?(a.push(e),s=i(e),s>a.lmt&&(a.lmt=s,a.params.query["_kmd.lmt"].$gt=new Date(s).toISOString()),o=!0):a.aux.push(e),a[e._id]=e))}),!n&&o&&a.store(),t&&t.call(a,e)},g=function(e){var t=this;r.unlist(t,t[e]),delete t[e],r.unlist(t.pending,e)},h=function(e){var t=this;return t[e].status="trash",r.unlist(t,t[e]),t.save(t[e],function(){t.removeLocal(e)})},m=function(e,n){var o=this,i=e._id;if(i||(i=e._id=r.generateId(),e._acl||(e._acl={}),e._acl.creator=t.id(),!o.onNew||o.onNew(e)))return o[i]?r.extend(o[i],e):o.push(o[i]=e),r.list(o.pending,i),o.syncUp(n||function(){o.store()}),i},v=function(e){var t=this,n=t[e];return n&&!~t.indexOf(n)&&t.push(n),t.store()},b=function(){var t=this;return e.set(t.url,t),e.set(t.url+":pending",t.pending),t},y=function(){var t=this;return e.remove(t.url).remove(t.url+":pending"),t},S=function(e){return e._acl.creator==t.id()},C=function(e){return this.isOwner(e)||e._acl.w&&~e._acl.w.indexOf(t.id())},E=function(e){return this[e]._acl.creator},w=function(e,t){var n=this,o=n[e]._acl.r;return o||(o=n[e]._acl.r=[]),r.list(o,t),n},$=function(e,t){var n=this,o=n[e]._acl.w;return o||(o=n[e]._acl.w=[]),r.list(o,t),n},k=function(e,t){var n=this,o=n[e]._acl.r;return o&&r.unlist(o,t),n},A=function(e,t){var n=this,o=n[e]._acl.w;return o&&r.unlist(o,t),n},x=function(e){var t=this[e]._acl;return t&&t.r||[]},D=function(e){var t=this[e]._acl;return t&&t.w||[]},_=function(e,t){var n=this,o=n[e]._acl;return o.r=t,n},F=function(e,t){var n=this,o=n[e]._acl;return o.w=t,n};return function(e){var t,n=[],o={url:"",run:s,save:m,remove:h,isOwner:S,isWriter:C,getOwner:E,syncDown:a,addWriter:$,addReader:w,removeWriter:A,removeReader:k,getReaders:x,getWriters:D,setReaders:_,setWriters:F,add:p,saveLocal:f,removeLocal:g,update:d,params:{},lmt:0,aux:[],pending:[],query:l,get:u,keep:v,syncUp:c,store:b,deleteStore:y,isNeeded:function(){return!0}};return r.extend(n,o,e),t=n.params,t.query=t.query||{},t.query["_kmd.lmt"]={$gt:"0"},n}}]),app.factory("keyboard",["$document","$timeout",function(e,t){function n(e){var n,o,r,s=e.keyCode,a=e.type;if((93==s||224==s)&&(s=91),s>95&&106>s&&(s-=48),110==s&&(s=190),109==s&&(s=189),111==s&&(s=191),"keyup"==a&&(r=u.indexOf(s),-1!==r&&u.splice(r,1)),n=e.target,3==n.nodeType&&(n=n.parentNode),"INPUT"==n.tagName||"SELECT"==n.tagName||"TEXTAREA"==n.tagName||n.contentEditable&&"true"==n.contentEditable){if(27!=s)return;n.blur()}if("keydown"==a){if(-1!==u.indexOf(s))return;u.push(s),i&&t.cancel(i),i=t(function(){u.length=0},1e3,!1)}o=c[a+":"+u.join("+")],o&&o.forEach(function(t){t(e)===!1&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0)})}function o(e,t){var n=[],o="+"===e?["+"]:e.split("+");return o.forEach(function(e){a[e]&&(n.push(16),e=a[e]),s[e]&&n.push(s[e])}),t+":"+n.join("+")}function r(e,t){var n,r;for(r in e)n=o(r,t),c[n]||(c[n]=[]),c[n].push(e[r])}var i,s={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,control:17,alt:18,option:18,capslock:20,esc:27,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,insert:45,del:46,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,"super":91,windows:91,"*":106,"+":107,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={},u=[];e.bind("keydown",n),e.bind("keyup",n);var l={on:function(){var e=arguments,t=e[0],n=e[2],o={};return"string"==typeof t?o[t]=e[1]:Array.isArray(t)?t.forEach(function(t){o[t]=e[1]}):(o=e[0],n=e[1]),r(o,n||"keydown"),this},off:function(e,t){var n=o(e,t);return c[n]&&delete c[n],this},reset:function(){return c={},this}};return l}]),app.factory("locale",function(){var e={},t=e.langs=[{code:"cs",name:"Czech","native":"Česky"},{code:"da",name:"Danish","native":"Dansk"},{code:"de",name:"German","native":"Deutsch"},{code:"en",name:"English","native":"English"},{code:"es",name:"Spanish","native":"Español"},{code:"fr",name:"French","native":"Français"},{code:"it",name:"Italian","native":"Italiano"},{code:"lv",name:"Latvian","native":"Latviešu"},{code:"lt",name:"Lithuanian","native":"Lietuvių"},{code:"hu",name:"Hungarian","native":"Magyar"},{code:"nl",name:"Dutch","native":"Nederlands"},{code:"no",name:"Norwegian","native":"Norsk"},{code:"pl",name:"Polish","native":"Polski"},{code:"pt",name:"Portuguese","native":"Português"},{code:"ro",name:"Romanian","native":"Română"},{code:"sq",name:"Albanian","native":"Shqip"},{code:"sk",name:"Slovak","native":"Slovenčina"},{code:"sl",name:"Slovene","native":"Slovenščina"},{code:"fi",name:"Finnish","native":"Suomi"},{code:"sv",name:"Swedish","native":"Svenska"},{code:"tr",name:"Turkish","native":"Türkçe"},{code:"el",name:"Greek","native":"Ελληνικά"},{code:"bg",name:"Bulgarian","native":"български"},{code:"ru",name:"Russian","native":"Pусский"},{code:"uk",name:"Ukrainian","native":"Українська"}];return e._={newSong:"New Song",editSong:"Edit Song",addToSet:"Add to Set",renameSet:"Rename Set",shareSet:"Share Set",settings:"Settings",noConnection:"Could not connect to the server!",outOfSync:"SongPane is out of sync. Please make sure you have an active internet connection.",quotaExceeded:"The local storage limit has been reached or local storage is disabled.",alert:"Alert",copy:"copy",keyboard:"Keyboard Shortcuts",illegalOperation:"You tried to perform an illegal operation!",key:"Key",currentKey:"Current Key",originalKey:"Original Key",tempo:"Tempo",signature:"Signature",timeSignature:"Time Signature",artist:"Artist(s)",copyright:"Copyright",profile:"Profile",buddies:"Buddies",remove:"Remove",owner:"Owner",save:"Save",add:"Add",addToNewSet:"Add the song to a new set",addToExistingSet:"or an existing set",selectSet:"Select a set",hideChords:"Hide chords",disconnect:"Disconnect",disconnectAccount:"Disconnect account",songTitle:"Song title",lyricsAndChords:"Lyrics and chords",nameSet:"Give this set a name",done:"Done",email:"Email",password:"Password",createAccount:"Create Account",resetPassword:"Reset Password",searchSongs:"Search songs",filterSongs:"Filter songs",sets:"Sets",catalog:"Catalog",search:"Search",noSets:"No Sets",creatingSets:"Sets are created by adding songs to them.",emptyCatalog:"Empty Catalog",aboutCatalog:"The catalog contains all the songs that you use or songs that you add to SongPane.",noResults:"No Results",searching:"Searching...",wait:"Wait...",standalone:"To enjoy this app to the fullest we recommend adding it to your Home Screen.",loggedOut:"You have been logged out.",notFound:"The resource was not found on the server.",genericError:"Something went wrong and it’s probably our fault.",confirm:"Are you sure?",explainDelSong:"Deleting the song makes it unavailable to any set that is currently using it!",del:"Delete",cancel:"Cancel",nextSongOrSet:"Next song or set",prevSongOrSet:"Previous song or set",toggleChords:"Toggle chord display",changeFontSize:"Decrease/increase font size",fontSize:"Font size",small:"Small",medium:"Medium",large:"Large",priv:"Private",pub:"Public",language:"Language",visibility:"Visibility",toggleFullscreen:"Toggle fullscreen",toggleInfo:"Toggle song info",toggleHelp:"Toggle help (this screen)",toggleSettings:"Toggle settings",esc:"Cancel actions, close modal windows",checkBody:"Please check the body of the song.",sharedSet:"A new set has been shared with you!",checkEmail:"Please check your email.",invalidCredentials:"Invalid credentials!",SPInvalidData:"The data you submitted was invalid.",SPOperationNotPermitted:"You are trying to perform an illegal operation.",SPInvalidQuery:""},t.forEach(function(e){t[e.code]=e}),e}),app.factory("md5",function(){function e(e,t){var s=e[0],a=e[1],c=e[2],u=e[3];s=n(s,a,c,u,t[0],7,-680876936),u=n(u,s,a,c,t[1],12,-389564586),c=n(c,u,s,a,t[2],17,606105819),a=n(a,c,u,s,t[3],22,-1044525330),s=n(s,a,c,u,t[4],7,-176418897),u=n(u,s,a,c,t[5],12,1200080426),c=n(c,u,s,a,t[6],17,-1473231341),a=n(a,c,u,s,t[7],22,-45705983),s=n(s,a,c,u,t[8],7,1770035416),u=n(u,s,a,c,t[9],12,-1958414417),c=n(c,u,s,a,t[10],17,-42063),a=n(a,c,u,s,t[11],22,-1990404162),s=n(s,a,c,u,t[12],7,1804603682),u=n(u,s,a,c,t[13],12,-40341101),c=n(c,u,s,a,t[14],17,-1502002290),a=n(a,c,u,s,t[15],22,1236535329),s=o(s,a,c,u,t[1],5,-165796510),u=o(u,s,a,c,t[6],9,-1069501632),c=o(c,u,s,a,t[11],14,643717713),a=o(a,c,u,s,t[0],20,-373897302),s=o(s,a,c,u,t[5],5,-701558691),u=o(u,s,a,c,t[10],9,38016083),c=o(c,u,s,a,t[15],14,-660478335),a=o(a,c,u,s,t[4],20,-405537848),s=o(s,a,c,u,t[9],5,568446438),u=o(u,s,a,c,t[14],9,-1019803690),c=o(c,u,s,a,t[3],14,-187363961),a=o(a,c,u,s,t[8],20,1163531501),s=o(s,a,c,u,t[13],5,-1444681467),u=o(u,s,a,c,t[2],9,-51403784),c=o(c,u,s,a,t[7],14,1735328473),a=o(a,c,u,s,t[12],20,-1926607734),s=r(s,a,c,u,t[5],4,-378558),u=r(u,s,a,c,t[8],11,-2022574463),c=r(c,u,s,a,t[11],16,1839030562),a=r(a,c,u,s,t[14],23,-35309556),s=r(s,a,c,u,t[1],4,-1530992060),u=r(u,s,a,c,t[4],11,1272893353),c=r(c,u,s,a,t[7],16,-155497632),a=r(a,c,u,s,t[10],23,-1094730640),s=r(s,a,c,u,t[13],4,681279174),u=r(u,s,a,c,t[0],11,-358537222),c=r(c,u,s,a,t[3],16,-722521979),a=r(a,c,u,s,t[6],23,76029189),s=r(s,a,c,u,t[9],4,-640364487),u=r(u,s,a,c,t[12],11,-421815835),c=r(c,u,s,a,t[15],16,530742520),a=r(a,c,u,s,t[2],23,-995338651),s=i(s,a,c,u,t[0],6,-198630844),u=i(u,s,a,c,t[7],10,1126891415),c=i(c,u,s,a,t[14],15,-1416354905),a=i(a,c,u,s,t[5],21,-57434055),s=i(s,a,c,u,t[12],6,1700485571),u=i(u,s,a,c,t[3],10,-1894986606),c=i(c,u,s,a,t[10],15,-1051523),a=i(a,c,u,s,t[1],21,-2054922799),s=i(s,a,c,u,t[8],6,1873313359),u=i(u,s,a,c,t[15],10,-30611744),c=i(c,u,s,a,t[6],15,-1560198380),a=i(a,c,u,s,t[13],21,1309151649),s=i(s,a,c,u,t[4],6,-145523070),u=i(u,s,a,c,t[11],10,-1120210379),c=i(c,u,s,a,t[2],15,718787259),a=i(a,c,u,s,t[9],21,-343485551),e[0]=l(s,e[0]),e[1]=l(a,e[1]),e[2]=l(c,e[2]),e[3]=l(u,e[3])}function t(e,t,n,o,r,i){return t=l(l(t,e),l(o,i)),l(t<<r|t>>>32-r,n)}function n(e,n,o,r,i,s,a){return t(n&o|~n&r,e,n,i,s,a)}function o(e,n,o,r,i,s,a){return t(n&r|o&~r,e,n,i,s,a)}function r(e,n,o,r,i,s,a){return t(n^o^r,e,n,i,s,a)}function i(e,n,o,r,i,s,a){return t(o^(n|~r),e,n,i,s,a)}function s(t){var n,o=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(n=64;t.length>=n;n+=64)e(r,a(t.substring(n-64,n)));t=t.substring(n-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;t.length>n;n++)i[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(e(r,i),n=0;16>n;n++)i[n]=0;return i[14]=8*o,e(r,i),r}function a(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function c(e){for(var t="",n=0;4>n;n++)t+=f[15&e>>8*n+4]+f[15&e>>8*n];return t}function u(e){for(var t=0;e.length>t;t++)e[t]=c(e[t]);return e.join("")}function l(e,t){return 4294967295&e+t}function d(e){return u(s(e||""))}var f="0123456789abcdef".split("");return d}),app.factory("modal",["$rootScope","$location","$routeParams","transitioner","$timeout",function(e,t,n,o,r){function i(e){t.search("modal",e||null)}var s=function(t){return e.modalClass?(e.modalClass="",o.apply("modal",function(){i(),t!=n.modal&&r(function(){i(t)})})):t&&i(t),!0};return s.isOn=function(t){return t?e.modalClass===t:e.modalClass},s}]),app.factory("notifier",function(){var e,t={title:"",icon:"info",delay:5e3},n=[],o=Object.keys;return{setCallback:function(t){return e=t,this},notify:function(r){return o(t).forEach(function(e){r[e]||(r[e]=t[e])}),n.push(r),e&&e(r),this},get:function(){return n}}}),app.factory("parse",["$window",function(){function e(e){var t=this;t.pos=t.start=0,t.string=e}return e.prototype={eof:function(){return this.pos>=this.string.length},sof:function(){return!this.pos},eol:function(){return this.pos>=this.string.length||"\n"==this.string.charAt(this.pos)},sol:function(){return!this.pos||"\n"==this.string.charAt(this.pos-1)},peek:function(){return this.string.charAt(this.pos)||null},next:function(){return this.pos<this.string.length&&this.string.charAt(this.pos++)},eat:function(e){var t,n=this.string.charAt(this.pos);return t="string"==typeof e?n==e:n&&(e.test?e.test(n):e(n)),t?(++this.pos,n):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skip:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return~t?(this.pos=t,!0):void 0},skipLine:function(){return this.skipTo("\n")&&this.pos<this.string.length&&++this.pos},backUp:function(e){this.pos-=e},column:function(){return this.start},match:function(e,t){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&t!==!1&&(this.pos+=n[0].length),n}return this.string.indexOf(e,this.pos)==this.pos?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},function(t,n,o){var r,i,s=n.startState()||!0;for(r=new e(t);!r.eof();)i=n.token(r,s),o(r.current(),i),r.start=r.pos}}]),function(){var e,t=navigator.userAgent;/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t)?e="ios":~t.toLowerCase().indexOf("firefox")&&(e="ff"),e&&(document.documentElement.className+=" "+e),app.constant("platform",e)}(),app.factory("settings",["store","util",function(e,t){var n={},o=function(t,o){n[t]=o,e.set("settings",n)};return t.extend(n,e.get("settings")||{}),{settings:n,set:o,toggle:function(e){o(e,!n[e])}}}]),app.service("store",["notifier","$window","locale",function(e,t,n){var o=t.localStorage,r=this;r.set=function(t,r){try{o.setItem(t,JSON.stringify(r))}catch(i){e.notify({message:n.quotaExceeded})}return r},r.get=function(e){return JSON.parse(o.getItem(e))},r.remove=function(e){return o.removeItem(e),r}}]),app.factory("touch",["$window","$timeout","util",function(e,t){function n(e){return b&&(e=e.touches[0]||e.changedTouches[0]),{x:e.pageX,y:e.pageY}}function o(e){var t=n(e);return t.dx=t.x-h.x,t.dy=t.y-h.y,t}function r(e,t){return w(E(t.x-e.x,2)+E(t.y-e.y,2))}function i(e){f=!0,h=n(e),p=e.target,m=t(function(){c("hold",h,e),g=!0},1e3)}function s(e){f&&(g?c("drag",o(e),e):t.cancel(m))}function a(e){f&&(t.cancel(m),g?c("release",o(e),e):10>r(n(e),h)&&c("tap",e),p=f=g=!1)}function c(e,t,n){for(var o,r,i=p;i&&i!=y&&(o=i.parentNode,r=S.indexOf(i),-1==r||!C[r][e]||!1!==C[r][e](n,t));)i=o}var u,l,d,f,p,g,h,m,v={},b="ontouchstart"in e,y=e.document,S=[],C=[],E=Math.pow,w=Math.sqrt;return b?(u="touchstart",l="touchmove",d="touchend"):(u="mousedown",l="mousemove",d="mouseup"),y.addEventListener(u,i,!0),y.addEventListener(l,s,!0),y.addEventListener(d,a,!0),["tap","hold","drag","release"].forEach(function(e){v[e]=function(t,n){t.length&&(t=t[0]);
var o=S.indexOf(t);-1==o&&(o=S.push(t)-1,C[o]={}),C[o][e]=n}}),v}]),app.factory("transitioner",["$rootScope","$document","util",function(e,t,n){function o(){var e,n=t[0].createElement("dummy"),o={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in o)if(void 0!==n.style[e])return o[e]}var r=o(),i={},s=[];return r&&t.bind(r,function(t){var n=t.target.id;if(n&&n in i){for(;i[n].length;)e.$apply(i[n].shift());delete i[n]}}),{apply:function(e,t,n){return r?(e in i&&!n||(i[e]=[]),i[e].push(t),void 0):(t(),void 0)},after:function(e,t,o){e[0]&&(e=e[0]),e.id||(e.id=n.generateId()),this.apply(e.id||s.push(e)-1,t,o)}}}]),app.factory("transposer",function(){var e=/C##|D##|E##|F##|G##|A##|B##|Cbb|Dbb|Ebb|Fbb|Gbb|Abb|Bbb|C#|D#|E#|F#|G#|A#|B#|Cb|Db|Eb|Fb|Gb|Ab|Bb|C|D|E|F|G|A|B/g,t=[["C","C#","Db","D","Eb","E","F","F#","Gb","G","Ab","A","Bb","B","Cb"],["Am","A#m","Bbm","Bm","Cm","C#m","Dm","D#m","Ebm","Em","Fm","F#m","Gm","G#m","Abm"]],n=[["C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#","Cb"],["C#","C##","D","D#","D##","E","E#","E##","F","F#","F##","G","G#","G##","A","A#","A##","B","B#","B##","C"],["Db","D","Ebb","Eb","E","Fb","F","F#","Gbb","Gb","G","Abb","Ab","A","Bbb","Bb","B","Cb","C","C#","Dbb"],["D","D#","Eb","E","E#","F","F#","F##","G#","G","G#","Ab","A","A#","Bb","B","B#","C","C#","C##","Db"],["Eb","E","Fb","F","F#","Gb","G","G#","Abb","Ab","A","Bbb","Bb","B","Cb","C","C#","Db","D","D#","Ebb"],["E","E#","F","F#","F##","G","G#","G##","Ab","A","A#","Bb","B","B#","C","C#","C##","D","D#","D##","Eb"],["F","F#","Gb","G","G#","Ab","A","A#","Bbb","Bb","B","Cb","C","C#","Db","D","D#","Eb","E","E#","Fb"],["F#","F##","G","G#","G##","A","A#","A##","Bb","B","B#","C","C#","C##","D","D#","D##","E","E#","E##","F"],["Gb","G","Abb","Ab","A","Bbb","Bb","B","Cbb","Cb","C","Dbb","Db","D","Ebb","Eb","E","Fb","F","F#","Gbb"],["G","G#","Ab","A","A#","Bb","B","B#","Cb","C","C#","Db","D","D#","Eb","E","E#","F","F#","F##","Gb"],["Ab","A","Bbb","Bb","B","Cb","C","C#","Dbb","Db","D","Ebb","Eb","E","Fb","F","F#","Gb","G","G#","Abb"],["A","A#","Bb","B","B#","C","C#","C##","Db","D","D#","Eb","E","E#","F","F#","F##","G","G#","G##","Ab"],["Bb","B","Cb","C","C#","Db","D","D#","Ebb","Eb","E","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bbb"],["B","B#","C","C#","C##","D","D#","D##","Eb","E","E#","F","F#","F##","G","G#","G##","A","A#","A##","Bb"],["Cb","C","Dbb","Db","D","Ebb","Eb","E","Fbb","Fb","F","Gbb","Gb","G","Abb","Ab","A","Bbb","Bb","B","Cbb"]];return{getKeys:function(e){return t[Number(e)]},getAllKeys:function(){return t[0].concat(t[1])},getScale:function(e){return n[t["m"===e.slice(-1)?1:0].indexOf(e)]},transpose:function(o,r,i){var s="m"===r.slice(-1)?1:0,a=t[s].indexOf(r),c=t[s].indexOf(i);return o.replace(e,function(e){return n[c][n[a].indexOf(e)]})}}}),function(e,t){app.service("util",["$window",function(n){var o=this,r=n.document,i=n.setTimeout,s=n.clearTimeout;o.toArray=function(e){return e&&e.forEach?e:[e]},o.list=function(e,t){var n=e.length;return o.toArray(t).forEach(function(t){var n=e.indexOf(t);~n||e.push(t)}),e.length-n},o.unlist=function(e,t){var n=e.indexOf(t);return~n&&e.splice(n,1),e.length},o.move=function(e,t,n){return e.splice(n,0,e.splice(t,1)[0]),e},o.pad=function(e,t){return Array(e+1).join(t||" ")},o.buildUrl=function(n,r){if(!r)return n;var i=[];return e.forEach(r,function(n,r){null!==n&&n!==t&&(e.isObject(n)&&(n=o.toJson(n)),i.push(encodeURIComponent(r)+"="+encodeURIComponent(n)))}),n+(-1==n.indexOf("?")?"?":"&")+i.join("&")},o.element=function(t){return e.isString(t)&&(t=r.getElementById(t)),e.element(t)},o.randomHex=function(e){for(var t="";e>0;)t+=Math.floor(Math.random()*Math.pow(10,16)).toString(16).substr(0,8>e?e:8),e-=8;return t},o.generateId=function(){return Math.floor(Date.now()/1e3).toString(16)+o.randomHex(16)},o.throttle=function(e,t){var n=null;return function(){var o=this,r=arguments;s(n),n=i(function(){e.apply(o,r),n=null},t)}},o.keys=Object.keys,o.toJson=n.JSON.stringify,["copy","extend","forEach","identity","fromJson","isObject","isString","isArray","lowercase","noop"].forEach(function(t){o[t]=e[t]})}])}(angular),app.factory("ws",["$rootScope","util","$window","$timeout",function(e,t,n,o){function r(e,n){return u&&(e&&(s=e),n&&(a=n),i=new u(s,t.toArray(a)),t.extend(i,f),r.emit("connecting")),r}var i,s,a,c,u=n.WebSocket,l=[],d=[],f={onopen:function(e){l.forEach(function(e){i.send(e)}),l.length=0,d.forEach(function(e){r.send("subscribe",{channel:e})}),r.emit("open",e)},onclose:function(e){return i=null,c?(c=!1,r.emit("close",e),void 0):(o(r,5e3),void 0)},onerror:function(e){r.emit("error",e)},onmessage:function(e){var n=t.fromJson(e.data);r.emit(n.event,n.data)}};return r.on=function(t,n){return e.$on(t,function(e,t){n(t)})},r.emit=function(t,n){return e.$emit(t,n)},r.sub=function(e){return r.send("subscribe",{channel:e}),t.list(d,e),function(){r.send("unsubscribe",{channel:e}),t.unlist(d,e)}},r.send=function(e,n){var o=t.toJson({event:e,data:n});return 1==i.readyState?i.send(o):l.push(o),r},r.close=function(){i&&(c=!0,i.close())},r}]);